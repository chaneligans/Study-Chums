<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Profile | Study Chums</title>
    <link rel="icon" href="images/favicon.ico">
    <link rel="stylesheet" href="main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>
    <script src="scripts/db_login.js"></script>
    <script src="scripts/db_register.js"></script>
    <script>
      $(document).ready(function(){
        $('.navbar-toggle').click(function() {
          $('#nav').toggle('.unhide');
        });
      });
    </script>
    <!-- FACEBOOK SIGN OUT-->
    <script type="text/javascript" src="scripts/facebook_logout.js"></script>
    <!-- END FACEBOOK SIGN OUT -->
  </head>
  <body>
    <!-- FIREBASE INITIALIZATION -->
    <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDFPHvR2SV7dodysPpvLUfIGp6huuBDf0A",
        authDomain: "study-chums.firebaseapp.com",
        databaseURL: "https://study-chums.firebaseio.com",
        projectId: "study-chums",
        storageBucket: "study-chums.appspot.com",
        messagingSenderId: "644812797355"
      };
      firebase.initializeApp(config);
    </script>
    <!-- END FIREBASE INITIALIZATION -->
    <div id="wrapper">
      <!-- NAVIGATION MENU -->
      <nav class="navbar">
        <span class="navbar-toggle" id="js-navbar-toggle">
        &#x2630;
        </span>
        <ul id="nav" class="main-nav">
          <li><a href="home.html" class="nav-item">Home</a></li>
          <li><a href="discover.html" class="nav-item">Discover</a></li>
          <li><a href="profile.html" class="nav-item">Profile</a></li>
          <li><a href="messages.html" class="nav-item">Messages</a></li>
          <li><a href="chums.html" class="nav-item">Chums</a></li>
          <li><a href="applications.html" class="nav-item">Applications</a></li>
          <li><a class="nav-item" onclick="facebookSignOut()">Sign Out</a></li>
        </ul>
      </nav>
      <!-- END OF NAVIGATION MENU -->
      <!-- Retrieve data-->
      <script>
        function getUserMajor() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database().ref("Users/" + user.uid);
              var Major_val;
              var userDataRef = firebase.database().ref();
              var MajorRef = userDataRef.child("Users/" + user.uid);
              MajorRef.once("value").then(function(snapshot){
                var key = snapshot.key;
                var childData = snapshot.val();              
                Major_val = snapshot.val().Major;
                console.log(Major_val);
                $("#Major").append(Major_val);
                document.getElementById("major").innerHTML = "Major: " + Major_val;
              });
            }
            else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserBio() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database().ref("Users/" + user.uid);
              var bio_val;
              var userDataRef = firebase.database().ref();
              var bioRef = userDataRef.child("Users/" + user.uid);
              bioRef.once("value").then(function(snapshot){
                var key = snapshot.key;
                var childData = snapshot.val();              
                bio_val = snapshot.val().bio;
                console.log(bio_val);
                $("#bio").append(bio_val);
                document.getElementById("bio").innerHTML = bio_val;
              });
            }
            else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserEmail() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database().ref("Users/" + user.uid);
              var email_val;
              var userDataRef = firebase.database().ref();
              var emailRef = userDataRef.child("Users/" + user.uid);
              emailRef.once("value").then(function(snapshot){
                var key = snapshot.key;
                var childData = snapshot.val();              
                email_val = snapshot.val().email;
                console.log(email_val);
                $("#email").append(email_val);
                document.getElementById("email").innerHTML = email_val;
              });
            }
            else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserName() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database().ref("Users/" + user.uid);
              var name_val;
              var userDataRef = firebase.database().ref();
              var nameRef = userDataRef.child("Users/" + user.uid);
              nameRef.once("value").then(function(snapshot){
                var key = snapshot.key;
                var childData = snapshot.val();              
                name_val = snapshot.val().name;
                console.log(name_val);
                $("#name").append(name_val);
                document.getElementById("name").innerHTML = name_val;
              });
            }
            else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserP1Url() {
          firebase.auth().onAuthStateChanged(function(user) {
            console.log(user.uid);
            if (user) {
              var db = firebase.database().ref("Users/" + user.uid);
              var image_val;
              var userDataRef = firebase.database().ref();
              var imageRef = userDataRef.child("Users/"+ user.uid)
              imageRef.once("value").then(function(snapshot){
                var key = snapshot.key;
                var childData = snapshot.val();              
                image_val = snapshot.val().p1Url;                
                $("#image").append(image_val);
                document.getElementById('img').src = image_val;
              });
            }
            else {
              console.log('Something went wrong!');
            }
          });
        }
      </script>
      <!-- CONTENT (description, profiles) -->
      <div id="content">
        <div id="description">
          <h1>Your Profile</h1>
          <h3><a href="edit_profile.html">Edit Profile</a></h3>
        </div>
        <div id="profileview">
          <div class="profilecard">
            <img id="img"><script>getUserP1Url();</script>
            <h2 id="name"></h2>
            <script>getUserName();</script>
            <p id="major" class="title"></p>
            <script>getUserMajor();</script>
            <p id="bio"></p>
            <script>getUserBio();</script>
            <div style="margin: 24px 0;">
              <a href="#"><i class="fa fa-dribbble"></i></a>
              <a href="#"><i class="fa fa-twitter"></i></a>
              <a href="#"><i class="fa fa-linkedin"></i></a>
              <a href="#"><i class="fa fa-facebook"></i></a>
            </div>
          </div>
        </div>
      </div>
      <!-- END CONTENT-->
      <!-- FOOTER -->
      <footer>
        Designed and Developed by Team Motivation 2019
      </footer>
      <!-- END FOOTER -->
    </div>
  </body>
</html>