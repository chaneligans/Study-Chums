<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Study Chums</title>
    <link rel="icon" href="images/favicon.ico">
    <link rel="stylesheet" href="main.css">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>

    <script type="text/javascript" src="scripts/db_login.js"></script>
    <script type="text/javascript" src="scripts/db_register.js"></script>

    <script>
    $(document).ready(function(){
      $('.navbar-toggle').click(function() {
        $('#nav').toggle('.unhide');
      });
    });
    </script>
  <body>
    
    <!-- FIREBASE INITIALIZATION -->
    <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDFPHvR2SV7dodysPpvLUfIGp6huuBDf0A",
        authDomain: "study-chums.firebaseapp.com",
        databaseURL: "https://study-chums.firebaseio.com",
        projectId: "study-chums",
        storageBucket: "study-chums.appspot.com",
        messagingSenderId: "644812797355"
      };
      firebase.initializeApp(config);
    </script>
    <!-- END FIREBASE INITIALIZATION -->
    
    <div id="wrapper">

      <!-- NAVIGATION MENU -->
      <nav class="navbar">
        <span class="navbar-toggle" id="js-navbar-toggle">
          &#x2630;
        </span>

        <ul id="nav" class="main-nav">
          <li><a href="home.html" class="nav-item">Home</a></li>
          <li><a href="profile.html" class="nav-item">Profile</a></li>
          <li><a href="messages.html" class="nav-item">Messages</a></li>
          <li><a href="chums.html" class="nav-item">Chums</a></li>
          <li><a href="applications.html" class="nav-item">Applications</a></li>
          <li><a href="index.html" class="nav-item" onclick="facebookSignOut()">Sign Out</a></li>
        </ul>
      </nav>
      <!-- END OF NAVIGATION MENU -->
      
      <!-- Retrieve data-->
      <script>
        function getUserMajor() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database().ref("Users/" + user.uid);
              var Major_val;
              var userDataRef = firebase.database().ref();
              var MajorRef = userDataRef.child("Users/" + user.uid);
              MajorRef.once("value").then(function(snapshot){
                var key = snapshot.key;
                var childData = snapshot.val();              
                Major_val = snapshot.val().Major;
                console.log(Major_val);
                $("#Major").append(Major_val);
                document.getElementById("major").innerHTML = 'Major: ' + Major_val;
                return Major_val;
              });
            }
            else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserBio() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database();
              this.userId = user.uid;
              var ref = db.ref("Users/" + this.userId);
              ref.child(this.userId).child("bio").on("value", function(userBioSnapshot) {
                var userBio = userBioSnapshot.val();
                console.log("User with id: " + this.userId + "'s bio is: " + userBio);
                return userBio;
              }); 
            }
             else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserEmail() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database();
              this.userId = user.uid;
              var ref = db.ref("Users/" + this.userId);
              ref.child(this.userId).child("email").on("value", function(userEmailSnapshot) {
                var userEmail = userEmailSnapshot.val();
                console.log("User with id: " + this.userId + "'s email is: " + userEmail);
                return userEmail;
              }); 
            }
             else {
              console.log('Something went wrong!');
            }
          });
        }
        
        function getUserName() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
                var db = firebase.database();
                this.userId = user.uid;
                var ref = db.ref("Users/" + this.userId);
                ref.child(this.userId).child("name").on("value", function(userNameSnapshot) {
                var userName = userNameSnapshot.val();
                console.log("User with id: " + this.userId + "'s name is: " + userName);
                return userName;
            });
            }
            else {
              console.log('Something went wrong');
            }

          });
        }
        
        function getUserP1Url() {
          firebase.auth().onAuthStateChanged(function(user) {
            if (user) {
              var db = firebase.database();
              this.userId = user.uid;
              var ref = db.ref("Users/" + this.userId);
              ref.child(this.userId).child("p1Url").on("value", function(userP1UrlSnapshot) {
                var userP1Url = userP1UrlSnapshot.val();
                console.log("User with id: " + this.userId + "'s p1 is: " + userP1Url);
                return userP1Url;
              }); 
            }
            else {
              console.log('Something went wrong');
            }
          });
        }
      </script>

      <!-- CONTENT (description, profiles) -->
      <div id="content">
        <div id="description">
          <h1>Your Profile</h1>
          <h3><a href="create_profile.html">Edit Profile</a></h3>
        </div>
        <div id="profileview">
          <div class="profilecard">
            <img src="images/sampleimage.jpg" style="width:100%">
            <h2>John Smith</h2>
            <p id="major" class="title"><script>getUserMajor();</script></p>
            <p>I love my school!</p>
              <div style="margin: 24px 0;">
                <a href="#"><i class="fa fa-dribbble"></i></a>
                <a href="#"><i class="fa fa-twitter"></i></a>
                <a href="#"><i class="fa fa-linkedin"></i></a>
                <a href="#"><i class="fa fa-facebook"></i></a>
              </div>
        </div>
      </div>
    </div>
      <!-- END CONTENT-->

      <!-- FOOTER -->
      <footer>
        Designed and Developed by Team Motivation 2019
      </footer>
      <!-- END FOOTER -->

    </div>
  </body>
</html>