<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset=utf-8>
    <title>Study Chums</title>
    <link rel="icon" href="images/favicon.ico">
    <link rel="stylesheet" href="main.css">

  </head>
  <body>

    <!-- FIREBASE INITIALIZATION -->
    <script src="https://www.gstatic.com/firebasejs/5.8.4/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyDFPHvR2SV7dodysPpvLUfIGp6huuBDf0A",
        authDomain: "study-chums.firebaseapp.com",
        databaseURL: "https://study-chums.firebaseio.com",
        projectId: "study-chums",
        storageBucket: "study-chums.appspot.com",
        messagingSenderId: "644812797355"
      };
      firebase.initializeApp(config);
    </script>
    <!-- END FIREBASE INITIALIZATION -->

    <!-- ///////////////////////////// -->

    <!-- FACEBOOK INITIALIZATION -->
    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '803620283323357',
          cookie     : true,
          xfbml      : true,
          version    : 'v3.2'
        });

        FB.AppEvents.logPageView();

      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v3.2&appId=803620283323357&autoLogAppEvents=1";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    </script>
    <!-- END FACEBOOK INITIALIZATION-->

    <!-- ///////////////////////////// -->

    <!-- FACEBOOK SIGN IN-->
    <script>
      function facebookSignIn() {
        var provider = new firebase.auth.FacebookAuthProvider();
        firebase.auth().signInWithPopup(provider).then(function(result) {
          console.log("Result: ",result);

          // This gives you a Facebook Access Token. You can use it to access the Facebook API.
          var token = result.credential.accessToken;

          // The signed-in user info.
          var user = result.user;
          console.log("Successfully signed in " + user.displayName);

          // Redirect after signing in
          if(result.additionalUserInfo.isNewUser) {
            //createProfile();
            window.location.href = "create_profile.html";
          } else {
            window.location.href = "home.html";
          }

        }).catch(function(error) {
          // Handle Errors here.
          var errorCode = error.code;
          var errorMessage = error.message;
          // The email of the user's account used.
          var email = error.email;
          // The firebase.auth.AuthCredential type that was used.
          var credential = error.credential;
        });
      }
    </script>
    <!-- END FACEBOOK SIGN IN / SIGN OUT -->

    <!-- ///////////////////////////// -->

    <!-- OTHER SCRIPTS / FUNCTIONS -->
    <script>
      function createProfile() {
        var rt = firebase.database();
        var fs = firebase.firestore();
        let user = firbase.auth().currentUser;

        // realtime
        rt.ref("Users/" + user.uid).set({
          Major: "",
          bio: "",
          email: user.email,
          name: user.displayName,
          p1Url: ""
        }, function(error) {
          if (error) {
            console.log("Account creation failed.");
          } else {
            console.log("Account creation succeeded.");
          }
        });
      }
    </script>
    <!-- END OTHER SCRIPTS / FUNCTIONS -->

    <!-- ///////////////////////////// -->

    <!-- (UI) LOGIN BOX -->
    <div class="login-box" style="text-align:center;">
      <h1>Welcome To Study Chums</h1>
      <button class = "fbbutton" onclick = "facebookSignIn()">Facebook Sign In</button>
    </div>
    <!-- END (UI) LOGIN BOX -->

  </body>
</html>