<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset=utf-8>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Discover | Study Chums</title>
    <link rel="icon" href="images/favicon.ico">
    <link rel="stylesheet" href="main.css">

    <!-- IMPORT ICONS -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">

    <!-- ??? -->
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- jQuery IMPORT -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- CHECK IF USED IS LOGGED IN -->
    <script type="text/javascript" src="scripts/check_login.js"></script>
    <script>//window.onload = checkLogin;</script>

    <!-- FACEBOOK SIGN OUT-->
    <script type="text/javascript" src="scripts/facebook_logout.js"></script>

    <!-- firebase IMPORT -->
    <script src="https://www.gstatic.com/firebasejs/5.8.2/firebase.js"></script>
    <script type="text/javascript" src="scripts/firebase-config.js"></script>
    <script>firebase.initializeApp(config);</script><!--Initialize Firebase-->

    <!-- miscellaneous -->
    <script>
      // $(document).ready(function(){
      //   $('.navbar-toggle').click(function() {
      //     $('#nav').toggle('.unhide');
      //   });
      // });
      $(document).ready(function() {
          $('.main-btn').click(function() {
              $('.search-description').slideToggle(100);
          });
          $('.search-description li').click(function() {
              var target = $(this).html();
              var toRemove = 'By ';
              var newTarget = target.replace(toRemove, '');
              //remove spaces
              newTarget = newTarget.replace(/\s/g, '');
              $(".search-large").html(newTarget);
              $('.search-description').hide();
              $('.main-input').hide();
              newTarget = newTarget.toLowerCase();
              $('.main-' + newTarget).show();
          });
          $('#main-submit-mobile').click(function() {
            $('#main-submit').trigger('click');
          });
          $(window).resize(function() {
            replaceMatches();
          });

          function replaceMatches() {
            var width = $(window).width();
            if (width < 516) {
              $('.main-location').attr('value', 'Major');
            } else {
              $('.main-location').attr('value', 'Major');
            }
          }

          replaceMatches();

          function clearText(thefield) {
            if (thefield.defaultValue === thefield.value) {
              thefield.value = ""
            }
          }

          function replaceText(thefield) {
            if (thefield.value === "") {
              thefield.value = thefield.defaultValue
            }
          }
      });
    </script>
    <!-- search -->
    <script>
        function Search() {
        $('html').addClass('waiting');
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            let value = document.getElementById("query").value;   // value
            let option = document.getElementById("option").value; // dropdown

            // execute only if something is there
            if (option === 'name') {
              if (value !== "") {SearchName(value);}
            }
            else if (option === 'major') {
              if (value !== "") {SearchMajor(value);}
            }
            else {
              alert('Invalid!');
            }

            console.log("Search sent to database.");
          } else {
            console.log("Who are you? And why do you have access to this?");
          }
        });
      }
        function SearchName(name_in){
          console.log(name_in);
            firebase.database().ref('Users/').orderByChild("name")
            .equalTo(name_in).once('value',function(snapshot){
                console.log(snapshot.val())
                console.log('-----------');

       //go through each item found and print out the emails
                snapshot.forEach(function(childSnapshot) {

                var key = childSnapshot.key;
                var childData = childSnapshot.val();

        //this will be the actual email value found
                console.log(childData.index);
                console.log("Index searched.");
                });
            });
        }
        function SearchMajor(major_in){
          console.log(major_in);
            firebase.database().ref('Users/').orderByChild("Major")
            .equalTo(major_in).once('value',function(snapshot){
                console.log(snapshot.val())
                console.log('-----------');

       //go through each item found and print out the emails
                snapshot.forEach(function(childSnapshot) {

                var key = childSnapshot.key;
                var childData = childSnapshot.val();

        //this will be the actual email value found
                console.log(childData.index);
                console.log("Index searched.");
                });
            });
        }
    </script>
  </head>
  <body>
    <!-- WRAPPER (WHITE BOX) -->
    <div id="wrapper">
      <!-- NAVIGATION MENU -->
      <nav>
        <button id="menubutton" class="accordion">Menu</button>
        <ul class="panel">
          <li><a href="home.html" class="nav-item">Home</a></li>
          <li><a href="discover.html" class="nav-item">Discover</a></li>
          <li><a href="profile.html" class="nav-item">Profile</a></li>
          <li><a href="messages.html" class="nav-item">Messages</a></li>
          <li><a href="chums.html" class="nav-item">Chums</a></li>
          <li><a href="applications.html" class="nav-item">Applications</a></li>
          <li><a class="nav-item" onclick="facebookSignOut();">Sign Out</a></li>
        </ul>
      </nav>
      <!-- END OF NAVIGATION MENU -->

      <!-- CONTENT (search bar, profiles) -->
      <div id="content">
        <div id="description">
          <h1>Search for Chums</h1>
        </div>
        <div class="searchBar">
          <div class="container">
            <div class="search">
              <input id="query" type="text" class="searchTerm" placeholder="What are you looking for?">
              <select id="option" class="searchOptions">
                <option value="name">Search by Name</option>
                <option value="major">Search by Major</option>
              </select>
                  <button type="submit" class="searchButton" onclick="Search();">
                <i class="fas fa-search"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
      <!-- END CONTENT-->

      <!-- FOOTER -->
      <footer>
        Designed and Developed by Team Motivation 2019
      </footer>
      <!-- END FOOTER -->
    </div>
    <!-- END WRAPPER (WHITE BOX) -->

    <script type="text/javascript" src="scripts/toggle_bio.js"></script>
  </body>
</html>